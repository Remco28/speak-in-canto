<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Canto Reader</title>
    <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ðŸ“–</text></svg>'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reader.css') }}">
  </head>
  <body>
    <main class="container">
      <header class="topbar">
        <h1 class="brand-title"><span class="brand-canto">CANTO</span><span class="brand-reader">reader</span></h1>
      </header>

      <section class="controls">
        <label for="text-input">Cantonese Text</label>
        <textarea id="text-input" rows="10" placeholder="Paste Cantonese text..."></textarea>
        <div class="meta-row">
          <p id="char-counter">0 / {{ max_input_chars }} characters</p>
          <p id="sync-mode-note" class="muted" hidden></p>
        </div>

        <div class="control-grid">
          <div>
            <label for="voice-mode-toggle">Voice Mode</label>
            <div class="mode-toggle-row">
              <span>Standard (Synced)</span>
              <label class="switch">
                <input id="voice-mode-toggle" type="checkbox" aria-label="Toggle high quality voice mode">
                <span class="slider"></span>
              </label>
              <span>High Quality</span>
            </div>
          </div>

          <div>
            <label for="voice-select">Voice</label>
            <div class="voice-dropdown">
              <button id="voice-dropdown-btn" type="button" class="voice-dropdown-btn">Select voice</button>
              <div id="voice-dropdown-menu" class="voice-dropdown-menu" hidden></div>
            </div>
          </div>

          <div>
            <label>Speed</label>
            <div class="speed-controls">
              <button id="speed-decrease-btn" type="button" class="button-secondary speed-btn" aria-label="Decrease speed">-</button>
              <span id="speed-label" class="speed-value">1.0x</span>
              <button id="speed-increase-btn" type="button" class="button-secondary speed-btn" aria-label="Increase speed">+</button>
            </div>
            <p id="speed-note" class="muted" hidden>High Quality speed changes may slightly affect voice quality.</p>
          </div>
        </div>

        <button id="read-btn" type="button">Read</button>
        <p id="error-banner" class="error" hidden></p>
      </section>

      <section class="reader-section">
        <h2>Reader</h2>
        <div id="token-view" class="token-view" aria-live="polite"></div>

        <div class="player">
          <audio id="audio-player" controls preload="none"></audio>
          <div class="download-row">
            <a id="download-btn" class="button button-secondary" href="#" hidden aria-disabled="true">Download MP3</a>
          </div>
        </div>
      </section>

      <section>
        <h2>English Translation</h2>
        <button id="translate-btn" type="button">Translate to English</button>
        <p id="translation-status" class="muted" hidden></p>
        <p id="translation-error" class="error" hidden></p>
        <div id="translation-output" class="translation-output" aria-live="polite"></div>
      </section>

      <footer class="footer-links">
        {% if user.is_admin %}
          <a href="{{ url_for('admin.dashboard') }}">Admin</a>
        {% endif %}
        <form method="post" action="{{ url_for('auth.logout') }}">
          <button type="submit" class="text-link">Log out</button>
        </form>
      </footer>
    </main>

    <script>
      window.READER_CONFIG = {
        maxInputChars: {{ max_input_chars|tojson }},
        maxTranslationInputChars: {{ max_translation_input_chars|tojson }},
        voices: {{ voice_catalog|tojson }},
      };
    </script>
    <script src="{{ url_for('static', filename='js/reader.js') }}"></script>
  </body>
</html>
